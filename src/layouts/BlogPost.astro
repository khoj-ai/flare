---
import type { CollectionEntry } from "astro:content";
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import FormattedDate from "../components/FormattedDate.astro";
import { AUTHOR_METADATA } from "../consts";

type Props = CollectionEntry<"posts">["data"];

const {
	title,
	description,
	pubDate,
	updatedDate,
	heroImage,
	author,
	keywords,
} = Astro.props;

const authorObj = AUTHOR_METADATA[author as keyof typeof AUTHOR_METADATA];
---

<html lang="en">
	<head>
		<BaseHead title={title} description={description} image={heroImage} />
		<style>
			main {
				width: 720px;
				max-width: calc(100% - 2em);
				margin: 0 auto;
				padding: 48px 24px;
			}

			article {
				width: 100%;
			}

			.prose {
				width: 100%;
				max-width: 100%;
			}

			.article-header {
				margin-bottom: 32px;
			}

			.title {
				font-family: var(--font-heading);
				font-size: var(--text-2xl);
				font-weight: var(--font-normal);
				letter-spacing: var(--tracking-normal);
				line-height: var(--leading-tight);
				color: var(--color-text);
				margin-bottom: var(--space-4);
			}

			.keywords {
				display: flex;
				flex-wrap: wrap;
				gap: 8px;
				margin-bottom: 16px;
			}

			.keyword {
				display: inline-block;
				font-family: var(--font-heading);
				font-size: var(--text-xs);
				font-weight: var(--font-medium);
				letter-spacing: var(--tracking-wider);
				text-transform: uppercase;
				color: var(--color-badge-text);
				background: var(--color-badge-bg);
				padding: var(--space-1) var(--space-2);
				border-radius: var(--radius-sm);
			}

			.meta {
				font-size: var(--text-sm);
				color: var(--color-text-muted);
				margin-bottom: var(--space-4);
			}

			.meta .last-updated {
				font-style: italic;
				margin-top: 4px;
			}

			.author {
				display: flex;
				align-items: center;
				gap: 12px;
				margin-bottom: 24px;
			}

			.author-image img {
				width: 36px;
				height: 36px;
				border-radius: 50%;
			}

			.author-name {
				font-size: var(--text-sm);
				color: var(--color-text);
			}

			.author-name a {
				color: var(--color-text);
				text-decoration: none;
			}

			.author-name a:hover {
				color: var(--color-link-hover);
			}

			hr {
				border: none;
				border-top: 1px solid var(--color-border);
				margin: 24px 0 32px;
			}

			:global(li[id^="user-content-fn-"]) {
				font-style: italic;
			}

			@media (max-width: 768px) {
				main {
					padding: 24px 20px;
				}

				.title {
					font-size: 24px;
				}

				.author-image img {
					width: 32px;
					height: 32px;
				}
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<article>
				<div class="prose">
					<div class="article-header">
						<h1 class="title">{title}</h1>
						{
							keywords && keywords.length > 0 && (
								<div class="keywords">
									{keywords.map((keyword) => (
										<span class="keyword">{keyword}</span>
									))}
								</div>
							)
						}
						<div class="meta">
							<FormattedDate date={pubDate} />
							{
								updatedDate && (
									<div class="last-updated">
										Last updated on{" "}
										<FormattedDate date={updatedDate} />
									</div>
								)
							}
						</div>
						<div class="author">
							<div class="author-image">
								<img
									src={authorObj.avatar}
									alt={authorObj.name}
								/>
							</div>
							<div class="author-name">
								<a href={authorObj.twitter}>
									{authorObj.name}
								</a>
							</div>
						</div>
						<hr />
					</div>
					<slot />
				</div>
			</article>
		</main>
		<Footer />
	</body>
</html>
